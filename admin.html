<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #F7F9FC; padding: 20px; text-align: center; }
        .login-box, .admin-panel { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); max-width: 800px; margin: auto; }
        .admin-panel { display: none; }
        input, button { padding: 12px; margin: 10px; border-radius: 8px; border: 1px solid #ddd; }
        button { background: #004e64; color: white; cursor: pointer; border: none; font-weight: bold; }
        button.delete { background: #c62828; }
        button.toggle { background: #f9a825; color: #004e64; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #eee; padding: 12px; text-align: center; }
        th { background: #004e64; color: white; }
    </style>
</head>
<body>

    <div id="loginBox" class="login-box">
        <h2>Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
        <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button onclick="checkPass()">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div id="adminPanel" class="admin-panel">
        <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ù†Ø´Ø·Ø© ğŸ› ï¸</h2>
        
        <div style="background: #f0f4f7; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
            <h3>Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø· Ø¬Ø¯ÙŠØ¯</h3>
            <input type="text" id="t" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
            <input type="text" id="i" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
            <input type="text" id="d" placeholder="Ø§Ù„ØªØ§Ø±ÙŠØ®">
            <input type="text" id="l" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ³Ø¬ÙŠÙ„">
            <button onclick="addActivity()">Ø¥Ø¶Ø§ÙØ© ÙˆÙ†Ø´Ø± ğŸš€</button>
        </div>

        <h3>Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ù†Ø´Ø§Ø·</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="list"></tbody>
        </table>
    </div>

    <script>
        const SUPABASE_URL = 'https://zqmxinxcczxhqcfczzxk.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpxbXhpbnhjY3p4aHFjZmN6enhrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyODA2NzEsImV4cCI6MjA4Njg1NjY3MX0.RUMibOBVFGTjGYBgmCRWSfnkqat7vbacJTr1_78PbN8';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function checkPass() {
            if(document.getElementById('pass').value === '29112002') {
                document.getElementById('loginBox').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                fetchActivities();
            } else { alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!"); }
        }

        async function fetchActivities() {
            const { data } = await _supabase.from('activities').select('*').order('id', { ascending: false });
            const list = document.getElementById('list');
            list.innerHTML = "";
            data.forEach(act => {
                list.innerHTML += `
                    <tr>
                        <td>${act.title}</td>
                        <td style="color:${act.is_open ? 'green':'red'}">${act.is_open ? 'Ù…ÙØªÙˆØ­':'Ù…ØºÙ„Ù‚'}</td>
                        <td>
                            <button class="toggle" onclick="toggleStatus(${act.id}, ${act.is_open})">ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©</button>
                            <button class="delete" onclick="deleteAct(${act.id})">Ø­Ø°Ù</button>
                        </td>
                    </tr>
                `;
            });
        }

        async function addActivity() {
            await _supabase.from('activities').insert([{ 
                title: document.getElementById('t').value, 
                image_url: document.getElementById('i').value, 
                day_date: document.getElementById('d').value, 
                reg_link: document.getElementById('l').value,
                is_open: true 
            }]);
            fetchActivities();
        }

        async function toggleStatus(id, current) {
            await _supabase.from('activities').update({ is_open: !current }).eq('id', id);
            fetchActivities();
        }

        async function deleteAct(id) {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) {
                await _supabase.from('activities').delete().eq('id', id);
                fetchActivities();
            }
        }
    </script>
</body>
</html>
