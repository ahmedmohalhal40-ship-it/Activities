<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f0f2f5; padding: 20px; direction: rtl; }
        .container { max-width: 900px; margin: auto; }
        .box { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        /* Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ±Ù… */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        input, textarea { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-family: 'Tajawal'; width: 100%; box-sizing: border-box; }
        textarea { grid-column: span 2; height: 80px; }
        .full-width { grid-column: span 2; }
        
        button { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-add { background: #004e64; color: white; width: 100%; margin-top: 10px; }
        .btn-edit { background: #f9a825; color: #004e64; }
        .btn-del { background: #d32f2f; color: white; }
        .btn-status { background: #eee; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #eee; text-align: center; }
        th { background: #004e64; color: white; }
        .edit-active { border: 2px solid #f9a825; background: #fffdf0; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginSection" class="box" style="text-align:center;">
        <h2>ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h2>
        <input type="password" id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="width:250px;">
        <button onclick="login()" class="btn-add" style="width:250px;">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div id="adminSection" style="display:none;">
        <div class="box" id="formBox">
            <h2 id="formTitle">Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø· Ø¬Ø¯ÙŠØ¯</h2>
            <div class="form-grid">
                <input type="hidden" id="actId">
                <input type="text" id="title" placeholder="Ø§Ø³Ù… Ø§Ù„Ù†Ø´Ø§Ø·">
                <input type="text" id="img" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
                <input type="text" id="day" placeholder="Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®">
                <input type="text" id="time" placeholder="Ø§Ù„Ø³Ø§Ø¹Ø©">
                <input type="text" id="loc" placeholder="Ø§Ù„Ù…ÙƒØ§Ù†" value="Ù†Ø§Ø¯ÙŠ Ø§Ù„Ù…Ø¹Ù‡Ø¯">
                <input type="text" id="link" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ³Ø¬ÙŠÙ„">
                <textarea id="desc" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
                <button onclick="saveActivity()" id="saveBtn" class="btn-add full-width">Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ù†Ø´Ø§Ø·</button>
                <button onclick="cancelEdit()" id="cancelBtn" class="full-width" style="display:none; background:#999; color:white;">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
            </div>
        </div>

        <div class="box">
            <h3>Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©</h3>
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù†Ø´Ø§Ø·</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø§Ù„ØªØ­ÙƒÙ…</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const SUPABASE_URL = 'https://zqmxinxcczxhqcfczzxk.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpxbXhpbnhjY3p4aHFjZmN6enhrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyODA2NzEsImV4cCI6MjA4Njg1NjY3MX0.RUMibOBVFGTjGYBgmCRWSfnkqat7vbacJTr1_78PbN8';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    function login() {
        if(document.getElementById('adminPass').value === '29112002') {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminSection').style.display = 'block';
            loadTable();
        } else { alert("Ø®Ø·Ø£ ÙÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!"); }
    }

    async function loadTable() {
        const { data } = await _supabase.from('activities').select('*').order('id', {ascending: false});
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = data.map(act => `
            <tr>
                <td>${act.title}</td>
                <td style="color:${act.is_open ? 'green':'red'}">${act.is_open ? 'Ù…ÙØªÙˆØ­':'Ù…ØºÙ„Ù‚'}</td>
                <td>
                    <button class="btn-edit" onclick='editMode(${JSON.stringify(act)})'>ØªØ¹Ø¯ÙŠÙ„</button>
                    <button class="btn-status" onclick="toggleStatus(${act.id}, ${act.is_open})">âš™ï¸</button>
                    <button class="btn-del" onclick="deleteAct(${act.id})">Ø­Ø°Ù</button>
                </td>
            </tr>
        `).join('');
    }

    async function saveActivity() {
        const id = document.getElementById('actId').value;
        const obj = {
            title: document.getElementById('title').value,
            image_url: document.getElementById('img').value,
            day_date: document.getElementById('day').value,
            activity_time: document.getElementById('time').value,
            location: document.getElementById('loc').value,
            reg_link: document.getElementById('link').value,
            details: document.getElementById('desc').value
        };

        if(id) {
            await _supabase.from('activities').update(obj).eq('id', id);
        } else {
            await _supabase.from('activities').insert([obj]);
        }
        cancelEdit();
        loadTable();
    }

    function editMode(act) {
        document.getElementById('formTitle').innerText = "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·";
        document.getElementById('formBox').classList.add('edit-active');
        document.getElementById('actId').value = act.id;
        document.getElementById('title').value = act.title;
        document.getElementById('img').value = act.image_url;
        document.getElementById('day').value = act.day_date;
        document.getElementById('time').value = act.activity_time;
        document.getElementById('loc').value = act.location;
        document.getElementById('link').value = act.reg_link;
        document.getElementById('desc').value = act.details;
        document.getElementById('saveBtn').innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
        document.getElementById('cancelBtn').style.display = "block";
        window.scrollTo(0,0);
    }

    function cancelEdit() {
        document.getElementById('actId').value = "";
        document.getElementById('formTitle').innerText = "Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø· Ø¬Ø¯ÙŠØ¯";
        document.getElementById('formBox').classList.remove('edit-active');
        document.querySelectorAll('input, textarea').forEach(i => i.value = "");
        document.getElementById('loc').value = "Ù†Ø§Ø¯ÙŠ Ø§Ù„Ù…Ø¹Ù‡Ø¯";
        document.getElementById('saveBtn').innerText = "Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ù†Ø´Ø§Ø·";
        document.getElementById('cancelBtn').style.display = "none";
    }

    async function toggleStatus(id, current) {
        await _supabase.from('activities').update({ is_open: !current }).eq('id', id);
        loadTable();
    }

    async function deleteAct(id) {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù†Ø´Ø§Ø·ØŸ")) {
            await _supabase.from('activities').delete().eq('id', id);
            loadTable();
        }
    }
</script>
</body>
</html>
